<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MortPion - Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .section h2 {
            margin-top: 0;
            color: #374151;
        }
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-enabled { background-color: #10b981; }
        .status-disabled { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        button:hover {
            opacity: 0.9;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .info {
            background-color: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .error {
            background-color: #fef2f2;
            border: 1px solid #ef4444;
            color: #dc2626;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .success {
            background-color: #f0fdf4;
            border: 1px solid #10b981;
            color: #059669;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .loading {
            display: none;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ MortPion - Admin Panel</h1>
        
        <div class="section">
            <h2>ðŸ“§ Email Notifications</h2>
            
            <div id="email-status">
                <div class="loading">Chargement du statut...</div>
            </div>
            
            <div style="margin-top: 20px;">
                <button id="toggle-email" class="btn-primary" disabled>
                    Activer les notifications
                </button>
                <button id="refresh-status" class="btn-primary">
                    ðŸ”„ Actualiser
                </button>
            </div>
            
            <div id="message-area"></div>
            
            <div class="info">
                <h4>Configuration requise :</h4>
                <ul>
                    <li><strong>EMAIL_NOTIFICATIONS_ENABLED</strong> : true/false</li>
                    <li><strong>ADMIN_EMAIL</strong> : votre email de rÃ©ception</li>
                    <li><strong>SMTP_USER</strong> : email d'envoi</li>
                    <li><strong>SMTP_PASS</strong> : mot de passe d'application</li>
                </ul>
                <p><strong>Note :</strong> Pour Gmail, utilisez un "mot de passe d'application" au lieu de votre mot de passe habituel.</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        
        async function fetchEmailStatus() {
            try {
                document.querySelector('.loading').style.display = 'block';
                const response = await fetch(`${API_BASE}/admin/email/status`);
                const data = await response.json();
                
                updateStatusDisplay(data);
                updateToggleButton(data.enabled);
                
            } catch (error) {
                showMessage('Erreur lors de la rÃ©cupÃ©ration du statut', 'error');
                console.error('Error fetching status:', error);
            } finally {
                document.querySelector('.loading').style.display = 'none';
            }
        }
        
        function updateStatusDisplay(status) {
            const statusHtml = `
                <div class="status">
                    <div class="status-indicator ${status.enabled ? 'status-enabled' : 'status-disabled'}"></div>
                    <strong>Notifications : ${status.enabled ? 'ActivÃ©es' : 'DÃ©sactivÃ©es'}</strong>
                </div>
                <div class="status">
                    <div class="status-indicator ${status.configured ? 'status-enabled' : 'status-warning'}"></div>
                    <strong>Configuration : ${status.configured ? 'OK' : 'IncomplÃ¨te'}</strong>
                </div>
                <div style="margin-top: 10px;">
                    <small><strong>Email admin :</strong> ${status.adminEmail}</small>
                </div>
            `;
            
            document.getElementById('email-status').innerHTML = statusHtml;
        }
        
        function updateToggleButton(enabled) {
            const button = document.getElementById('toggle-email');
            button.disabled = false;
            
            if (enabled) {
                button.textContent = 'DÃ©sactiver les notifications';
                button.className = 'btn-danger';
            } else {
                button.textContent = 'Activer les notifications';
                button.className = 'btn-success';
            }
        }
        
        async function toggleEmailNotifications() {
            const button = document.getElementById('toggle-email');
            const currentlyEnabled = button.textContent.includes('DÃ©sactiver');
            const newState = !currentlyEnabled;
            
            try {
                button.disabled = true;
                button.textContent = 'Traitement...';
                
                const response = await fetch(`${API_BASE}/admin/email/toggle`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ enabled: newState })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(data.message, 'success');
                    updateStatusDisplay(data.status);
                    updateToggleButton(newState);
                } else {
                    showMessage(data.error || 'Erreur lors du changement', 'error');
                    updateToggleButton(currentlyEnabled);
                }
                
            } catch (error) {
                showMessage('Erreur de connexion', 'error');
                updateToggleButton(currentlyEnabled);
                console.error('Error toggling notifications:', error);
            }
        }
        
        function showMessage(text, type) {
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = `<div class="${type}">${text}</div>`;
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }
        
        // Event listeners
        document.getElementById('toggle-email').addEventListener('click', toggleEmailNotifications);
        document.getElementById('refresh-status').addEventListener('click', fetchEmailStatus);
        
        // Initial load
        fetchEmailStatus();
    </script>
</body>
</html>
